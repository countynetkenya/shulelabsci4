<VirtualHost *:80>
    ServerAdmin dev@shulelabs.local
    ServerName localhost
    DocumentRoot /workspace/shulelabs

    <Directory /workspace/shulelabs>
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted

        DirectoryIndex index.php
        
        # CodeIgniter URL rewriting
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            
            # Redirect trailing slashes (optional, for clean URLs)
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.+)/$ /$1 [R=301,L]
            
            # Handle front controller
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.php/$1 [L,QSA]
        </IfModule>
    </Directory>

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # PHP settings
    php_value upload_max_filesize 32M
    php_value post_max_size 32M
    php_value memory_limit 512M
    php_value max_execution_time 120

    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined
    
    # Don't log static assets in detail
    SetEnvIf Request_URI "\.(?:css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$" dontlog
    CustomLog /var/log/apache2/access.log combined env=!dontlog
</VirtualHost>
