diff --git a/mvc/controllers/Creditmemo.php b/mvc/controllers/Creditmemo.php
index 384df5d2c89d2f4d8c224fdf9e5bd9360464593f..9f8bbe9f4f705d534dc5a346b2de124289bd530e 100644
--- a/mvc/controllers/Creditmemo.php
+++ b/mvc/controllers/Creditmemo.php
@@ -1,28 +1,30 @@
 <?php if(!defined('BASEPATH'))
     exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Facades\Customer;
 use QuickBooksOnline\API\Facades\Item;
 use QuickBooksOnline\API\Facades\CreditMemo as QBCreditMemo;
 use QuickBooksOnline\API\Facades\Account;
 use QuickBooksOnline\API\Core\Http\Serialization\XmlObjectSerializer;
 
 class Creditmemo extends Admin_Controller
 {
     /*
     | -----------------------------------------------------
     | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
     | -----------------------------------------------------
     | AUTHOR:			INILABS TEAM
     | -----------------------------------------------------
     | EMAIL:			info@inilabs.net
     | -----------------------------------------------------
     | COPYRIGHT:		RESERVED BY INILABS IT
     | -----------------------------------------------------
     | WEBSITE:			http://inilabs.net
     | -----------------------------------------------------
     */
 
     function __construct()
     {
diff --git a/mvc/controllers/Credittypes.php b/mvc/controllers/Credittypes.php
index 56f2dfc0f98065514c89992f8b395844ad3bc5d9..18e1f7af0cd56bcd5e5e9a7ce2c896b4031408f2 100644
--- a/mvc/controllers/Credittypes.php
+++ b/mvc/controllers/Credittypes.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 const INCOME_ACCOUNT_TYPE = "Income";
 
 class Credittypes extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 		$this->load->model("credittypes_m");
 		$this->load->model("quickbookssettings_m");
 		$this->load->model("quickbookslog_m");
 		$language = $this->session->userdata('lang');
 		$this->lang->load('credittypes', $language);
@@ -71,74 +73,76 @@ class Credittypes extends Admin_Controller {
                 $month = date('M', mktime(0, 0, 0, $i));
                 $array = [
                     'credittypes' => $this->input->post('credittypes'). ' ['.$month.']',
                     "note"     => $this->input->post("note"),
 										"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 										"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 										"schoolID" => $schoolID,
                 ];
                 $this->credittypes_m->insert_credittypes($array);
             }
         } else {
             $array = [
                 "credittypes" => $this->input->post("credittypes"),
                 "note"     => $this->input->post("note"),
 								"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 								"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 								"schoolID" => $schoolID,
             ];
 
             $this->credittypes_m->insert_credittypes($array);
         }
 
 				$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 				redirect(base_url("credittypes/index"));
 			}
-		} else {
-			// Create SDK instance
+                } else {
+                        // Create SDK instance
       $config = $this->quickbooksConfig();
+                        $this->data["config"] = $config;
+                        $this->data["authUrl"] = '';
+                        $this->data["incomeaccounts"] = [];
 
-			if ($config['active'] == "1") {
+                        if ($config['active'] == "1") {
 
 	      $dataService = DataService::Configure(array(
 	        'auth_mode' => 'oauth2',
 	        'ClientID' => $config['client_id'],
 	        'ClientSecret' =>  $config['client_secret'],
 	        'RedirectURI' => base_url() . "quickbooks/callback",
 	        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 	        'baseUrl' => $config['stage']
 	      ));
 
 				$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 				$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 				// Store the url in PHP Session Object;
-				$_SESSION['authUrl'] = $authUrl;
-				$this->data["authUrl"] = $authUrl;
-				$this->data["config"] = $config;
+                                $_SESSION['authUrl'] = $authUrl;
+                                $this->data["authUrl"] = $authUrl;
 
-				if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 					/*
 		      * Retrieve the accessToken value from session variable
 		      */
 		      $accessToken = unserialize($config['sessionAccessToken']);
 
 		      $dataService->throwExceptionOnError(true);
 
 		      /*
 		      * Update the OAuth2Token of the dataService object
 		      */
 		      $dataService->updateOAuth2Token($accessToken);
 
 		      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 		      if (!file_exists($path)) {
 		        mkdir($path, 0777, true);
 		      }
 		      $dataService->setLogLocation($path);
 					$this->data["incomeaccounts"] = $this->getIncomeAccountObj($dataService);
 				}
 		  }
 
 			$this->data['headerassets'] = [
 					'css' => [
 							'assets/select2/css/select2.css',
 							'assets/select2/css/select2-bootstrap.css'
@@ -156,73 +160,75 @@ class Credittypes extends Admin_Controller {
 	public function edit() {
 		$id = htmlentities(escapeString($this->uri->segment(3)));
 		if((int)$id) {
 			$this->data['credittypes'] = $this->credittypes_m->get_single_credittypes(array('credittypesID' => $id, 'schoolID' => $this->session->userdata('schoolID')));
 			if($this->data['credittypes']) {
 				if($_POST) {
 					$rules = $this->rules();
 					$this->form_validation->set_rules($rules);
 					if ($this->form_validation->run() == FALSE) {
 						$this->data["subview"] = "credittypes/edit";
 						$this->load->view('_layout_main', $this->data);
 					} else {
 						$incomeaccount = $this->input->post('incomeaccount');
 						$incomeaccountArray = explode(",", $incomeaccount);
 						$array = array(
 							"credittypes" => $this->input->post("credittypes"),
 							"note" => $this->input->post("note"),
 							"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 							"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 						);
 
 						$this->credittypes_m->update_credittypes($array, $id);
 						$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 						redirect(base_url("credittypes/index"));
 					}
-				} else {
-					// Create SDK instance
-		      $config = $this->quickbooksConfig();
-
-					if ($config['active'] == "1") {
+                                } else {
+                                        // Create SDK instance
+                      $config = $this->quickbooksConfig();
+                                        $this->data["config"] = $config;
+                                        $this->data["authUrl"] = '';
+                                        $this->data["incomeaccounts"] = [];
+
+                                        if ($config['active'] == "1") {
 			      $dataService = DataService::Configure(array(
 			        'auth_mode' => 'oauth2',
 			        'ClientID' => $config['client_id'],
 			        'ClientSecret' =>  $config['client_secret'],
 			        'RedirectURI' => base_url() . "quickbooks/callback",
 			        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 			        'baseUrl' => $config['stage']
 			      ));
 
 						$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 						$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 						// Store the url in PHP Session Object;
-						$_SESSION['authUrl'] = $authUrl;
-						$this->data["authUrl"] = $authUrl;
-						$this->data["config"] = $config;
+                                                $_SESSION['authUrl'] = $authUrl;
+                                                $this->data["authUrl"] = $authUrl;
 
-						if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 							/*
 				      * Retrieve the accessToken value from session variable
 				      */
 				      $accessToken = unserialize($config['sessionAccessToken']);
 
 				      $dataService->throwExceptionOnError(true);
 
 				      /*
 				      * Update the OAuth2Token of the dataService object
 				      */
 				      $dataService->updateOAuth2Token($accessToken);
 
 				      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 				      if (!file_exists($path)) {
 				        mkdir($path, 0777, true);
 				      }
 				      $dataService->setLogLocation($path);
 
 							$this->data["incomeaccounts"] = $this->getIncomeAccountObj($dataService);
 						}
 					}
 
 					$this->data['headerassets'] = [
 							'css' => [
 									'assets/select2/css/select2.css',
diff --git a/mvc/controllers/Divisions.php b/mvc/controllers/Divisions.php
index 23ca7013a70d86663b8ef6316c9f1e81c80c2ccc..4621ae58bcb8e0ff0ea30d88bdb317e75d38a941 100644
--- a/mvc/controllers/Divisions.php
+++ b/mvc/controllers/Divisions.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 class Divisions extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 		$this->load->model("divisions_m");
 		$this->load->model("quickbookssettings_m");
 		$this->load->model("quickbookslog_m");
 		$language = $this->session->userdata('lang');
 		$this->lang->load('divisions', $language);
 	}
 
@@ -49,74 +51,76 @@ class Divisions extends Admin_Controller {
 
 	public function add() {
 		if($_POST) {
 			$rules = $this->rules();
 			$this->form_validation->set_rules($rules);
 			if ($this->form_validation->run() == FALSE) {
 				$this->data["subview"] = "divisions/add";
 				$this->load->view('_layout_main', $this->data);
 			} else {
 				$schoolID = $this->session->userdata('schoolID');
 				$quickbooksclass = $this->input->post('quickbooksclass');
 				$quickbooksclassArray = explode(",", $quickbooksclass);
         $array = [
             "divisions" => $this->input->post("divisions"),
             "note"     => $this->input->post("note"),
 						"quickbooksclassID" => is_numeric($quickbooksclassArray[0]) ? $quickbooksclassArray[0] : NULL,
 						"quickbooksclass"  => !empty($quickbooksclassArray[1]) ? $quickbooksclassArray[1] : NULL,
 						"schoolID" => $schoolID,
         ];
 
         $this->divisions_m->insert_divisions($array);
 
 				$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 				redirect(base_url("divisions/index"));
 			}
-		} else {
-			// Create SDK instance
+                } else {
+                        // Create SDK instance
       $config = $this->quickbooksConfig();
+                        $this->data["config"] = $config;
+                        $this->data["authUrl"] = '';
+                        $this->data["quickbooksclasses"] = [];
 
-			if ($config['active'] == "1") {
+                        if ($config['active'] == "1") {
 
 	      $dataService = DataService::Configure(array(
 	        'auth_mode' => 'oauth2',
 	        'ClientID' => $config['client_id'],
 	        'ClientSecret' =>  $config['client_secret'],
 	        'RedirectURI' => base_url() . "quickbooks/callback",
 	        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 	        'baseUrl' => $config['stage']
 	      ));
 
 				$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 				$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 				// Store the url in PHP Session Object;
-				$_SESSION['authUrl'] = $authUrl;
-				$this->data["authUrl"] = $authUrl;
-				$this->data["config"] = $config;
+                                $_SESSION['authUrl'] = $authUrl;
+                                $this->data["authUrl"] = $authUrl;
 
-				if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 					/*
 		      * Retrieve the accessToken value from session variable
 		      */
 		      $accessToken = unserialize($config['sessionAccessToken']);
 
 		      $dataService->throwExceptionOnError(true);
 
 		      /*
 		      * Update the OAuth2Token of the dataService object
 		      */
 		      $dataService->updateOAuth2Token($accessToken);
 
 		      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 		      if (!file_exists($path)) {
 		        mkdir($path, 0777, true);
 		      }
 		      $dataService->setLogLocation($path);
 					$this->data["quickbooksclasses"] = $this->getClassObj($dataService);
 				}
 		  }
 
 			$this->data['headerassets'] = [
 					'css' => [
 							'assets/select2/css/select2.css',
 							'assets/select2/css/select2-bootstrap.css'
@@ -135,73 +139,75 @@ class Divisions extends Admin_Controller {
 		$id = htmlentities(escapeString($this->uri->segment(3)));
 		if((int)$id) {
 			$schoolID = $this->session->userdata('schoolID');
 			$this->data['divisions'] = $this->divisions_m->get_single_divisions(array('divisionsID' => $id, 'schoolID' => $schoolID));
 			if($this->data['divisions']) {
 				if($_POST) {
 					$rules = $this->rules();
 					$this->form_validation->set_rules($rules);
 					if ($this->form_validation->run() == FALSE) {
 						$this->data["subview"] = "divisions/edit";
 						$this->load->view('_layout_main', $this->data);
 					} else {
 						$quickbooksclass = $this->input->post('quickbooksclass');
 						$quickbooksclassArray = explode(",", $quickbooksclass);
 						$array = array(
 							"divisions" => $this->input->post("divisions"),
 							"note" => $this->input->post("note"),
 							"quickbooksclassID" => is_numeric($quickbooksclassArray[0]) ? $quickbooksclassArray[0] : NULL,
 							"quickbooksclass"  => !empty($quickbooksclassArray[1]) ? $quickbooksclassArray[1] : NULL,
 						);
 
 						$this->divisions_m->update_divisions($array, $id);
 						$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 						redirect(base_url("divisions/index"));
 					}
-				} else {
-					// Create SDK instance
-		      $config = $this->quickbooksConfig();
-
-					if ($config['active'] == "1") {
+                                } else {
+                                        // Create SDK instance
+                      $config = $this->quickbooksConfig();
+                                        $this->data["config"] = $config;
+                                        $this->data["authUrl"] = '';
+                                        $this->data["quickbooksclasses"] = [];
+
+                                        if ($config['active'] == "1") {
 			      $dataService = DataService::Configure(array(
 			        'auth_mode' => 'oauth2',
 			        'ClientID' => $config['client_id'],
 			        'ClientSecret' =>  $config['client_secret'],
 			        'RedirectURI' => base_url() . "quickbooks/callback",
 			        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 			        'baseUrl' => $config['stage']
 			      ));
 
 						$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 						$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 						// Store the url in PHP Session Object;
-						$_SESSION['authUrl'] = $authUrl;
-						$this->data["authUrl"] = $authUrl;
-						$this->data["config"] = $config;
+                                                $_SESSION['authUrl'] = $authUrl;
+                                                $this->data["authUrl"] = $authUrl;
 
-						if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 							/*
 				      * Retrieve the accessToken value from session variable
 				      */
 				      $accessToken = unserialize($config['sessionAccessToken']);
 
 				      $dataService->throwExceptionOnError(true);
 
 				      /*
 				      * Update the OAuth2Token of the dataService object
 				      */
 				      $dataService->updateOAuth2Token($accessToken);
 
 				      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 				      if (!file_exists($path)) {
 				        mkdir($path, 0777, true);
 				      }
 				      $dataService->setLogLocation($path);
 
 							$this->data["quickbooksclasses"] = $this->getClassObj($dataService);
 						}
 					}
 
 					$this->data['headerassets'] = [
 							'css' => [
 									'assets/select2/css/select2.css',
diff --git a/mvc/controllers/Feetypes.php b/mvc/controllers/Feetypes.php
index 54296c5c3aadaf67a2e98412a5b75e686d896e85..9cd372a124d1f93d9830b28160ea26cde74c41bc 100644
--- a/mvc/controllers/Feetypes.php
+++ b/mvc/controllers/Feetypes.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 const INCOME_ACCOUNT_TYPE = "Income";
 
 class Feetypes extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 		$this->load->model("feetypes_m");
 		$this->load->model("quickbookssettings_m");
 		$this->load->model("quickbookslog_m");
 		$language = $this->session->userdata('lang');
 		$this->lang->load('feetypes', $language);
@@ -71,73 +73,75 @@ class Feetypes extends Admin_Controller {
                 $month = date('M', mktime(0, 0, 0, $i));
                 $array = [
                     'feetypes'         => $this->input->post('feetypes'). ' ['.$month.']',
                     "note"             => $this->input->post("note"),
 										"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 										"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 										"schoolID"         => $schoolID,
                 ];
                 $this->feetypes_m->insert_feetypes($array);
             }
         } else {
             $array = [
                 "feetypes"         => $this->input->post("feetypes"),
                 "note"             => $this->input->post("note"),
 								"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 								"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 								"schoolID"         => $schoolID,
             ];
 
             $this->feetypes_m->insert_feetypes($array);
         }
 
 				$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 				redirect(base_url("feetypes/index"));
 			}
-		} else {
-			// Create SDK instance
+                } else {
+                        // Create SDK instance
       $config = $this->quickbooksConfig();
+                        $this->data["config"] = $config;
+                        $this->data["authUrl"] = '';
+                        $this->data["incomeaccounts"] = [];
 
-			if ($config['active'] == "1") {
+                        if ($config['active'] == "1") {
 	      $dataService = DataService::Configure(array(
 	        'auth_mode' => 'oauth2',
 	        'ClientID' => $config['client_id'],
 	        'ClientSecret' =>  $config['client_secret'],
 	        'RedirectURI' => base_url() . "quickbooks/callback",
 	        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 	        'baseUrl' => $config['stage']
 	      ));
 
 				$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 				$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 				// Store the url in PHP Session Object;
-				$_SESSION['authUrl'] = $authUrl;
-				$this->data["authUrl"] = $authUrl;
-				$this->data["config"] = $config;
+                                $_SESSION['authUrl'] = $authUrl;
+                                $this->data["authUrl"] = $authUrl;
 
-				if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 					/*
 		      * Retrieve the accessToken value from session variable
 		      */
 		      $accessToken = unserialize($config['sessionAccessToken']);
 
 		      $dataService->throwExceptionOnError(true);
 
 		      /*
 		      * Update the OAuth2Token of the dataService object
 		      */
 		      $dataService->updateOAuth2Token($accessToken);
 
 		      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 		      if (!file_exists($path)) {
 		        mkdir($path, 0777, true);
 		      }
 		      $dataService->setLogLocation($path);
 
 					$this->data["incomeaccounts"] = $this->getIncomeAccountObj($dataService);
 				}
 			}
 
 			$this->data['headerassets'] = [
 					'css' => [
 							'assets/select2/css/select2.css',
@@ -156,73 +160,75 @@ class Feetypes extends Admin_Controller {
 	public function edit() {
 		$id = htmlentities(escapeString($this->uri->segment(3)));
 		if((int)$id) {
 			$this->data['feetypes'] = $this->feetypes_m->get_single_feetypes(array('feetypesID' => $id, 'schoolID' => $this->session->userdata('schoolID')));
 			if($this->data['feetypes']) {
 				if($_POST) {
 					$rules = $this->rules();
 					$this->form_validation->set_rules($rules);
 					if ($this->form_validation->run() == FALSE) {
 						$this->data["subview"] = "feetypes/edit";
 						$this->load->view('_layout_main', $this->data);
 					} else {
 						$incomeaccount = $this->input->post('incomeaccount');
 						$incomeaccountArray = explode(",", $incomeaccount);
 						$array = array(
 							"feetypes" => $this->input->post("feetypes"),
 							"note" => $this->input->post("note"),
 							"incomeaccountID"  => is_numeric($incomeaccountArray[0]) ? $incomeaccountArray[0] : NULL,
 							"incomeaccount"    => !empty($incomeaccountArray[1]) ? $incomeaccountArray[1] : NULL,
 						);
 
 						$this->feetypes_m->update_feetypes($array, $id);
 						$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 						redirect(base_url("feetypes/index"));
 					}
-				} else {
-					// Create SDK instance
-		      $config = $this->quickbooksConfig();
-
-					if ($config['active'] == "1") {
+                                } else {
+                                        // Create SDK instance
+                      $config = $this->quickbooksConfig();
+                                        $this->data["config"] = $config;
+                                        $this->data["authUrl"] = '';
+                                        $this->data["incomeaccounts"] = [];
+
+                                        if ($config['active'] == "1") {
 			      $dataService = DataService::Configure(array(
 			        'auth_mode' => 'oauth2',
 			        'ClientID' => $config['client_id'],
 			        'ClientSecret' =>  $config['client_secret'],
 			        'RedirectURI' => base_url() . "quickbooks/callback",
 			        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 			        'baseUrl' => $config['stage']
 			      ));
 
 						$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 						$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 						// Store the url in PHP Session Object;
-						$_SESSION['authUrl'] = $authUrl;
-						$this->data["authUrl"] = $authUrl;
-						$this->data["config"] = $config;
+                                                $_SESSION['authUrl'] = $authUrl;
+                                                $this->data["authUrl"] = $authUrl;
 
-						if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 							/*
 				      * Retrieve the accessToken value from session variable
 				      */
 				      $accessToken = unserialize($config['sessionAccessToken']);
 
 				      $dataService->throwExceptionOnError(true);
 
 				      /*
 				      * Update the OAuth2Token of the dataService object
 				      */
 				      $dataService->updateOAuth2Token($accessToken);
 
 				      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 				      if (!file_exists($path)) {
 				        mkdir($path, 0777, true);
 				      }
 				      $dataService->setLogLocation($path);
 
 							$this->data["incomeaccounts"] = $this->getIncomeAccountObj($dataService);
 						}
 				  }
 
 					$this->data['headerassets'] = [
 							'css' => [
 									'assets/select2/css/select2.css',
diff --git a/mvc/controllers/Inventoryinvoice.php b/mvc/controllers/Inventoryinvoice.php
index f47f510fbbd8d9fb6facf8590b16c6c97384671a..1162736cb715992e02997d64414369907d7969f8 100644
--- a/mvc/controllers/Inventoryinvoice.php
+++ b/mvc/controllers/Inventoryinvoice.php
@@ -1,28 +1,30 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
 require_once(APPPATH . 'libraries/PaymentGateway/PaymentGateway.php');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use Mike42\Escpos\Printer;
 use Mike42\Escpos\ImagickEscposImage;
 use Mike42\Escpos\PrintConnectors\FilePrintConnector;
 
 class Inventoryinvoice extends Admin_Controller {
     /*
     | -----------------------------------------------------
     | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
     | -----------------------------------------------------
     | AUTHOR:			INILABS TEAM
     | -----------------------------------------------------
     | EMAIL:			info@inilabs.net
     | -----------------------------------------------------
     | COPYRIGHT:		RESERVED BY INILABS IT
     | -----------------------------------------------------
     | WEBSITE:			http://inilabs.net
     | -----------------------------------------------------
     */
 
     public $payment_gateway;
 
     function __construct() {
         parent::__construct();
         $this->load->model('usertype_m');
         $this->load->model('paymenttypes_m');
diff --git a/mvc/controllers/Invoice.php b/mvc/controllers/Invoice.php
index 80e3bd7d4b336cc0fce581306f1af5384f7c32ce..db6ba2b27df22f775ffd1a80133dd3b7cd9e8b39 100644
--- a/mvc/controllers/Invoice.php
+++ b/mvc/controllers/Invoice.php
@@ -1,30 +1,32 @@
 <?php if(!defined('BASEPATH'))
     exit('No direct script access allowed');
 require_once(APPPATH . 'libraries/PaymentGateway/PaymentGateway.php');
 require_once(APPPATH . 'libraries/PaymentGateway/Service/PaymentService.php');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Facades\Customer;
 use QuickBooksOnline\API\Facades\Item;
 use QuickBooksOnline\API\Facades\Invoice as QBInvoice;
 use QuickBooksOnline\API\Facades\Account;
 use QuickBooksOnline\API\Core\Http\Serialization\XmlObjectSerializer;
 
 class Invoice extends Admin_Controller
 {
     /*
     | -----------------------------------------------------
     | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
     | -----------------------------------------------------
     | AUTHOR:			INILABS TEAM
     | -----------------------------------------------------
     | EMAIL:			info@inilabs.net
     | -----------------------------------------------------
     | COPYRIGHT:		RESERVED BY INILABS IT
     | -----------------------------------------------------
     | WEBSITE:			http://inilabs.net
     | -----------------------------------------------------
     */
     protected $_amountgivenstatus = '';
     protected $_amountgivenstatuserror = [];
     public $payment_gateway;
@@ -186,72 +188,73 @@ class Invoice extends Admin_Controller
             $this->data["subview"]              = "invoice/index";
             $this->load->view('_layout_main', $this->data);
         }
     }
 
     public function add()
     {
         if(($this->data['siteinfos']->school_year == $this->session->userdata('defaultschoolyearID')) || ($this->session->userdata('usertypeID') == 1) || ($this->session->userdata('defaultschoolyearID') == 5)) {
             $this->data['headerassets'] = [
                 'css' => [
                     'assets/datepicker/datepicker.css',
                     'assets/select2/css/select2.css',
                     'assets/select2/css/select2-bootstrap.css'
                 ],
                 'js'  => [
                     'assets/datepicker/datepicker.js',
                     'assets/select2/select2.js'
                 ]
             ];
 
             $schoolID = $this->session->userdata('schoolID');
             $this->data['classes']  = $this->classes_m->general_get_order_by_classes(array('schoolID' => $schoolID));
 			      $this->data['terms']  = $this->schoolterm_m->get_order_by_schoolterm(array('schoolyearID' => $this->data['siteinfos']->school_year, 'schoolID' => $schoolID));
             $this->data['feetypes'] = $this->feetypes_m->get_order_by_feetypes(array('schoolID' => $schoolID));
             $this->data['bundlefeetypes'] = $this->bundlefeetypes_m->get_bundlefeetypes_with_feetypes_total();
-			      $this->data['studentgroups'] = $this->studentgroup_m->get_order_by_studentgroup(array('schoolID' => $schoolID));
+                              $this->data['studentgroups'] = $this->studentgroup_m->get_order_by_studentgroup(array('schoolID' => $schoolID));
             $this->data['students'] = [];
 
             $config = $this->quickbooksConfig();
+            $this->data["config"] = $config;
+            $this->data["authUrl"] = '';
 
             if ($config['active'] == "1") {
               $dataService = DataService::Configure(array(
                   'auth_mode' => 'oauth2',
                   'ClientID' => $config['client_id'],
                   'ClientSecret' =>  $config['client_secret'],
                   'RedirectURI' => base_url() . "quickbooks/callback",
                   'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
                   'baseUrl' => $config['stage']
               ));
 
               $OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
               $authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
               // Store the url in PHP Session Object;
               $_SESSION['authUrl'] = $authUrl;
               $this->data["authUrl"] = $authUrl;
-              $this->data["config"] = $config;
             }
 
             $this->data["subview"] = "invoice/add";
             $this->load->view('_layout_main', $this->data);
         } else {
             $this->data["subview"] = "error";
             $this->load->view('_layout_main', $this->data);
         }
     }
 
     public function edit()
     {
         if(($this->data['siteinfos']->school_year == $this->session->userdata('defaultschoolyearID')) || ($this->session->userdata('usertypeID') == 1) || ($this->session->userdata('defaultschoolyearID') == 5)) {
             $this->data['headerassets'] = [
                 'css' => [
                     'assets/datepicker/datepicker.css',
                     'assets/select2/css/select2.css',
                     'assets/select2/css/select2-bootstrap.css'
                 ],
                 'js'  => [
                     'assets/datepicker/datepicker.js',
                     'assets/select2/select2.js'
                 ]
             ];
 
diff --git a/mvc/controllers/Mailandsms.php b/mvc/controllers/Mailandsms.php
index 55bfa71b195842ca6593e7b79c08060d149b8554..789bd7e7a87a9e5739a537fdc38cb4c7abc3750d 100644
--- a/mvc/controllers/Mailandsms.php
+++ b/mvc/controllers/Mailandsms.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 
 class Mailandsms extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct () {
 		parent::__construct();
 		$this->load->model('usertype_m');
 		$this->load->model('systemadmin_m');
 		$this->load->model('teacher_m');
 		$this->load->model('student_m');
 		$this->load->model('parents_m');
 		$this->load->model('user_m');
 		$this->load->model('classes_m');
 		$this->load->model('section_m');
diff --git a/mvc/controllers/Payment.php b/mvc/controllers/Payment.php
index a8ccb4bdfcd83204dad5c4a3f37c228b78e8aa0d..3e3a651b0a049a9e326d549b7c216267bfcb207e 100644
--- a/mvc/controllers/Payment.php
+++ b/mvc/controllers/Payment.php
@@ -1,28 +1,30 @@
 <?php if(!defined('BASEPATH'))
     exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 class Payment extends Admin_Controller
 {
     /*
     | -----------------------------------------------------
     | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
     | -----------------------------------------------------
     | AUTHOR:			INILABS TEAM
     | -----------------------------------------------------
     | EMAIL:			info@inilabs.net
     | -----------------------------------------------------
     | COPYRIGHT:		RESERVED BY INILABS IT
     | -----------------------------------------------------
     | WEBSITE:			http://inilabs.net
     | -----------------------------------------------------
     */
     protected $_amountgivenstatus = '';
     protected $_amountgivenstatuserror = [];
 
     function __construct()
     {
         parent::__construct();
         $this->load->model('payment_m');
 		    $this->load->model('invoice_m');
@@ -135,68 +137,69 @@ class Payment extends Admin_Controller
 			   }
 			   $this->data['students'] = $students;
       } elseif($usertypeID == 1) {
 			  $this->data['students'] = [];
       }
 
 		  $this->data['headerassets'] = [
         'css' => [
 					 'assets/datepicker/datepicker.css',
            'assets/select2/css/select2.css',
            'assets/select2/css/select2-bootstrap.css'
 
         ],
         'js'  => [
 				  'assets/datepicker/datepicker.js',
           'assets/select2/select2.js'
         ]
       ];
 
 		  $this->data['classes']  = $this->classes_m->general_get_order_by_classes(array('schoolID' => $schoolID));
 		  $this->data['studentgroups'] = $this->studentgroup_m->get_order_by_studentgroup(array('schoolID' => $schoolID));
 		  $this->data['usertypeID']  = $usertypeID;
 		  $this->data['terms'] = $this->schoolterm_m->get_order_by_schoolterm(array('schoolyearID' => $schoolyearID, 'schoolID' => $schoolID));
 
       $config = $this->quickbooksConfig();
+      $this->data["config"] = $config;
+      $this->data["authUrl"] = '';
 
       if ($config['active'] == "1") {
         $dataService = DataService::Configure(array(
             'auth_mode' => 'oauth2',
             'ClientID' => $config['client_id'],
             'ClientSecret' =>  $config['client_secret'],
             'RedirectURI' => base_url() . "quickbooks/callback",
             'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
             'baseUrl' => $config['stage']
         ));
 
         $OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
         $authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
         // Store the url in PHP Session Object;
         $_SESSION['authUrl'] = $authUrl;
         $this->data["authUrl"] = $authUrl;
-        $this->data["config"] = $config;
       }
 
 		  $this->data["subview"]  = "payment/index";
 		  $this->load->view('_layout_main', $this->data);
     }
 
 	public function getstudent()
   {
     $classesID = $this->input->post('classesID');
 		$studentGroupID = $this->input->post('studentGroupID');
     $schoolyearID = $this->session->userdata('defaultschoolyearID');
 		$usertypeID = $this->session->userdata("usertypeID");
 		$userID = $this->session->userdata('loginuserID');
 
 		echo '<option value="0">' . $this->lang->line('payment_select_student') . '</option>';
 
 		$array = array('srschoolID' => $this->session->userdata('schoolID'), 'srschoolyearID' => $schoolyearID, 'srclassesID' => $classesID);
 
 		if ($studentGroupID != 0)
 			$array['srstudentGroupID'] = $studentGroupID;
 		if ($usertypeID == 4)
 			$array['parentID'] = $userID;
 
 		$students = $this->studentrelation_m->get_order_by_student($array);
 
diff --git a/mvc/controllers/Paymenttypes.php b/mvc/controllers/Paymenttypes.php
index 42891300a6cb5bd605bdd4859297bc44e3dd290a..1bb75f02a735afda3c4a92b4843546a096d7f4b2 100644
--- a/mvc/controllers/Paymenttypes.php
+++ b/mvc/controllers/Paymenttypes.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 const PAYMENT_ACCOUNT_TYPE = "Bank";
 
 class Paymenttypes extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 		$this->load->model("paymenttypes_m");
 		$this->load->model("quickbookssettings_m");
 		$this->load->model("quickbookslog_m");
 		$language = $this->session->userdata('lang');
 		$this->lang->load('paymenttypes', $language);
@@ -50,74 +52,76 @@ class Paymenttypes extends Admin_Controller {
 	}
 
 	public function add() {
 		if($_POST) {
 			$rules = $this->rules();
 			$this->form_validation->set_rules($rules);
 			if ($this->form_validation->run() == FALSE) {
 				$this->data["subview"] = "paymenttypes/add";
 				$this->load->view('_layout_main', $this->data);
 			} else {
 				$deposittoaccountref = $this->input->post('deposittoaccountref');
 				$deposittoaccountrefArray = explode(",", $deposittoaccountref);
         $array = [
             "paymenttypes" => $this->input->post("paymenttypes"),
             "note" => $this->input->post("note"),
 						"deposittoaccountrefID" => is_numeric($deposittoaccountrefArray[0]) ? $deposittoaccountrefArray[0] : NULL,
 						"deposittoaccountref" => !empty($deposittoaccountrefArray[1]) ? $deposittoaccountrefArray[1] : NULL,
 						"schoolID" => $this->session->userdata('schoolID'),
         ];
 
         $this->paymenttypes_m->insert_paymenttypes($array);
 
 				$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 				redirect(base_url("paymenttypes/index"));
 			}
-		} else {
-			// Create SDK instance
+                } else {
+                        // Create SDK instance
       $config = $this->quickbooksConfig();
+                        $this->data["config"] = $config;
+                        $this->data["authUrl"] = '';
+                        $this->data["deposittoaccountrefs"] = [];
 
-			if ($config['active'] == "1") {
+                        if ($config['active'] == "1") {
 
 	      $dataService = DataService::Configure(array(
 	        'auth_mode' => 'oauth2',
 	        'ClientID' => $config['client_id'],
 	        'ClientSecret' =>  $config['client_secret'],
 	        'RedirectURI' => base_url() . "quickbooks/callback",
 	        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 	        'baseUrl' => $config['stage']
 	      ));
 
 				$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 				$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 				// Store the url in PHP Session Object;
-				$_SESSION['authUrl'] = $authUrl;
-				$this->data["authUrl"] = $authUrl;
-				$this->data["config"] = $config;
+                                $_SESSION['authUrl'] = $authUrl;
+                                $this->data["authUrl"] = $authUrl;
 
-				if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 					/*
 		      * Retrieve the accessToken value from session variable
 		      */
 		      $accessToken = unserialize($config['sessionAccessToken']);
 
 		      $dataService->throwExceptionOnError(true);
 
 		      /*
 		      * Update the OAuth2Token of the dataService object
 		      */
 		      $dataService->updateOAuth2Token($accessToken);
 
 		      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 		      if (!file_exists($path)) {
 		        mkdir($path, 0777, true);
 		      }
 		      $dataService->setLogLocation($path);
 					$this->data["deposittoaccountrefs"] = $this->getDepositToAccountRefObj($dataService);
 				}
 		  }
 
 			$this->data['headerassets'] = [
 					'css' => [
 							'assets/select2/css/select2.css',
 							'assets/select2/css/select2-bootstrap.css'
@@ -135,73 +139,75 @@ class Paymenttypes extends Admin_Controller {
 	public function edit() {
 		$id = htmlentities(escapeString($this->uri->segment(3)));
 		if((int)$id) {
 			$this->data['paymenttypes'] = $this->paymenttypes_m->get_single_paymenttypes(array('paymenttypesID' => $id, 'schoolID' => $this->session->userdata('schoolID')));
 			if($this->data['paymenttypes']) {
 				if($_POST) {
 					$rules = $this->rules();
 					$this->form_validation->set_rules($rules);
 					if ($this->form_validation->run() == FALSE) {
 						$this->data["subview"] = "paymenttypes/edit";
 						$this->load->view('_layout_main', $this->data);
 					} else {
 						$deposittoaccountref = $this->input->post('deposittoaccountref');
 						$deposittoaccountrefArray = explode(",", $deposittoaccountref);
 						$array = array(
 							"paymenttypes" => $this->input->post("paymenttypes"),
 							"note" => $this->input->post("note"),
 							"deposittoaccountrefID" => is_numeric($deposittoaccountrefArray[0]) ? $deposittoaccountrefArray[0] : NULL,
 							"deposittoaccountref"  => !empty($deposittoaccountrefArray[1]) ? $deposittoaccountrefArray[1] : NULL,
 						);
 
 						$this->paymenttypes_m->update_paymenttypes($array, $id);
 						$this->session->set_flashdata('success', $this->lang->line('menu_success'));
 						redirect(base_url("paymenttypes/index"));
 					}
-				} else {
-					// Create SDK instance
-		      $config = $this->quickbooksConfig();
-
-					if ($config['active'] == "1") {
+                                } else {
+                                        // Create SDK instance
+                      $config = $this->quickbooksConfig();
+                                        $this->data["config"] = $config;
+                                        $this->data["authUrl"] = '';
+                                        $this->data["deposittoaccountrefs"] = [];
+
+                                        if ($config['active'] == "1") {
 			      $dataService = DataService::Configure(array(
 			        'auth_mode' => 'oauth2',
 			        'ClientID' => $config['client_id'],
 			        'ClientSecret' =>  $config['client_secret'],
 			        'RedirectURI' => base_url() . "quickbooks/callback",
 			        'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 			        'baseUrl' => $config['stage']
 			      ));
 
 						$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 						$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 						// Store the url in PHP Session Object;
-						$_SESSION['authUrl'] = $authUrl;
-						$this->data["authUrl"] = $authUrl;
-						$this->data["config"] = $config;
+                                                $_SESSION['authUrl'] = $authUrl;
+                                                $this->data["authUrl"] = $authUrl;
 
-						if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
+                                                if (!empty($config['sessionAccessToken']) && now() < $config['sessionAccessTokenExpiry']) {
 							/*
 				      * Retrieve the accessToken value from session variable
 				      */
 				      $accessToken = unserialize($config['sessionAccessToken']);
 
 				      $dataService->throwExceptionOnError(true);
 
 				      /*
 				      * Update the OAuth2Token of the dataService object
 				      */
 				      $dataService->updateOAuth2Token($accessToken);
 
 				      $path = APPPATH . '../mvc/logs/quickbooks/'. date('Y-m-d');
 				      if (!file_exists($path)) {
 				        mkdir($path, 0777, true);
 				      }
 				      $dataService->setLogLocation($path);
 
 							$this->data["deposittoaccountrefs"] = $this->getDepositToAccountRefObj($dataService);
 						}
 					}
 
 					$this->data['headerassets'] = [
 							'css' => [
 									'assets/select2/css/select2.css',
diff --git a/mvc/controllers/Quickbooks.php b/mvc/controllers/Quickbooks.php
index 40f6429d2ed4ccc764f28ea8e191e7995fa6b0b4..933bf55463eb9f76dab715d41864483d4d270dc0 100644
--- a/mvc/controllers/Quickbooks.php
+++ b/mvc/controllers/Quickbooks.php
@@ -1,127 +1,141 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Facades\Customer;
 use QuickBooksOnline\API\Facades\Item;
 use QuickBooksOnline\API\Facades\Invoice;
 use QuickBooksOnline\API\Facades\CreditMemo;
 use QuickBooksOnline\API\Facades\Payment;
 use QuickBooksOnline\API\Facades\Account;
 use QuickBooksOnline\API\Core\OAuth\OAuth2\OAuth2LoginHelper;
 use QuickBooksOnline\API\Core\Http\Serialization\XmlObjectSerializer;
 use QuickBooksOnline\API\Exception\SdkException;
 
 class Quickbooks extends Admin_Controller {
+    protected $quickbooksSdkReady = false;
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
-	function __construct() {
-		parent::__construct();
+        function __construct() {
+                parent::__construct();
 
     $this->load->model("bundlefeetype_feetypes_m");
     $this->load->model('quickbookssettings_m');
 		$this->load->model('invoice_m');
 		$this->load->model('creditmemo_m');
 		$this->load->model('payment_m');
 		$this->load->model('student_m');
 		$this->load->model("feetypes_m");
 		$this->load->model("credittypes_m");
 		$this->load->model("paymenttypes_m");
 		$this->load->model("quickbookslog_m");
 		$this->load->model("classes_m");
 		$this->load->model("section_m");
-		$this->load->model("studentrelation_m");
-		$language = $this->session->userdata('lang');
-		$this->lang->load('quickbooks', $language);
+                $this->load->model("studentrelation_m");
+                $language = $this->session->userdata('lang');
+                $this->lang->load('quickbooks', $language);
+    $this->quickbooksSdkReady = quickbooks_sdk_available();
+    $this->data['quickbooksSdkReady'] = $this->quickbooksSdkReady;
   }
 
+        protected function ensureQuickbooksSdkReady() {
+                if(!$this->quickbooksSdkReady) {
+                        $this->session->set_flashdata('error', 'QuickBooks integration is currently unavailable.');
+                        redirect('quickbookssettings');
+                }
+        }
+
 	protected function rules()
 	{
 			$rules = [
 					[
 							'field' => 'classesID',
 							'label' => $this->lang->line("class"),
 							'rules' => 'trim|required|xss_clean|max_length[11]',
 					],
 					[
 							'field' => 'sectionID',
 							'label' => $this->lang->line("section"),
 							'rules' => 'trim|xss_clean|max_length[11]',
 					],
 					[
 							'field' => 'studentID',
 							'label' => $this->lang->line("student"),
 							'rules' => 'trim|xss_clean|max_length[11]',
 					],
 			];
 
 			return $rules;
 	}
 
-	public function index() {
-		$this->data['headerassets'] = [
-				'css' => [
-						'assets/datepicker/datepicker.css',
+        public function index() {
+                $this->ensureQuickbooksSdkReady();
+                $this->data['headerassets'] = [
+                                'css' => [
+                                                'assets/datepicker/datepicker.css',
 						'assets/select2/css/select2.css',
 						'assets/select2/css/select2-bootstrap.css'
 				],
 				'js'  => [
 					  'assets/datepicker/datepicker.js',
 						'assets/select2/select2.js'
 				]
-		];
+                ];
 
-		$config = $this->quickbooksConfig();
+                $config = $this->quickbooksConfig();
+                $this->data['config'] = $config;
+                $this->data['authUrl'] = '';
 
-		if($config['client_id'] != "" && $config['client_secret'] != "" && ($config['stage'] == "development" || $config['stage'] == "production")) {
-			$dataService = DataService::Configure(array(
-					'auth_mode' => 'oauth2',
-					'ClientID' => $config['client_id'],
+                if($this->quickbooksSdkReady && $config['client_id'] != "" && $config['client_secret'] != "" && ($config['stage'] == "development" || $config['stage'] == "production")) {
+                        $dataService = DataService::Configure(array(
+                                        'auth_mode' => 'oauth2',
+                                        'ClientID' => $config['client_id'],
 					'ClientSecret' =>  $config['client_secret'],
 					'RedirectURI' => base_url() . "quickbooks/callback",
 					'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 					'baseUrl' => $config['stage']
 			));
 
 			$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 			$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 			// Store the url in PHP Session Object;
-			$_SESSION['authUrl'] = $authUrl;
-			$this->data["authUrl"] = $authUrl;
-			$this->data["config"] = $config;
+                        $_SESSION['authUrl'] = $authUrl;
+                        $this->data["authUrl"] = $authUrl;
 
 			$schoolID                  = $this->session->userdata('schoolID');
 			$schoolyearID              = $this->session->userdata('defaultschoolyearID');
 			$this->data['classes']     = $this->classes_m->get_order_by_classes(array('schoolID' => $schoolID));
 			$this->data['invoices']    = $this->invoice_m->get_invoice_with_student(array('deleted_at' => 1, 'student.studentID !=' => NULL, 'schoolID' => $schoolID));
 			$this->data['creditmemos'] = $this->creditmemo_m->get_creditmemo_with_student(array('deleted_at' => 1, 'student.studentID !=' => NULL, 'schoolID' => $schoolID));
 			$this->data['payments']    = $this->payment_m->get_payment_with_student(array('schoolID' => $schoolID,  'student.studentID !=' => NULL));
 			$this->data['logs']        = $this->quickbookslog_m->get_order_by_quickbookslog(array('schoolID' => $schoolID));
 
 			if($_POST) {
 				$rules = $this->rules();
 				$this->form_validation->set_rules($rules);
 				if ($this->form_validation->run() == FALSE) {
 						$this->data["subview"]  = "quickbooks/index";
 						$this->load->view('_layout_main', $this->data);
 				} else {
 						/*
 						* Retrieve the accessToken value from session variable
 						*/
 						$accessToken = unserialize($config['sessionAccessToken']);
 
 						$dataService->throwExceptionOnError(true);
 
 						/*
 						* Update the OAuth2Token of the dataService object
@@ -172,52 +186,53 @@ class Quickbooks extends Admin_Controller {
 								**/
 								// payment
 								$qbPaymentTotalAmount = $this->QBPayments($dataService, $student);
 								// invoice and creditmemo
 								$qbInvoiceTotalAmount = $this->QBInvoices($dataService, $student);
 								$qbCreditmemoTotalAmount = $this->QBCreditmemos($dataService, $student);
 								$qbBalance = $qbInvoiceTotalAmount - ($qbPaymentTotalAmount + $qbCreditmemoTotalAmount);
 								$result[$student->srstudentID]['shulelabs'] = $balance;
 								$result[$student->srstudentID]['quickbooks'] = $qbBalance;
 							}
 							$this->data['students'] = $students;
 							$this->data['balances'] = $result;
 							$this->data['tab'] = "balances";
 						}
 				}
 			}
 
 			$this->data["subview"] = "quickbooks/index";
 			$this->load->view('_layout_main', $this->data);
 		}
 		else {
 			redirect("quickbookssettings");
 		}
 	}
 
-	public function sync() {
-		 $schoolID = $this->session->userdata('schoolID');
+        public function sync() {
+                $this->ensureQuickbooksSdkReady();
+                 $schoolID = $this->session->userdata('schoolID');
 		 $start = $this->input->post('start');
 		 $end = $this->input->post('end');
 		 $ids = json_decode($this->input->post('ids'));
 		 $type = $this->input->post('type');
 		 $invoiceAndCreditmemoArray['schoolID'] = $schoolID;
 		 $paymentArray['schoolID'] = $schoolID;
 		 $results = [];
 
 		 if (customCompute($ids)) {
 			 if($type == "invoice") {
 				 foreach ($ids as $id) {
 					  $invoice = $this->invoice_m->get_single_invoice(array('invoiceID' => $id, 'schoolID' => $schoolID));
 					  $student = $this->student_m->get_student($invoice->studentID);
 		 				if (!empty($invoice->bundlefeetypeID)) {
 		 						$bundlefeetype_feetypes = $this->bundlefeetype_feetypes_m->get_order_by_bundlefeetype_feetypes(array("bundlefeetypesID" => $invoice->bundlefeetypeID));
 		 						foreach ($bundlefeetype_feetypes as $bundlefeetype_feetype) {
 		 								$array[] = [
 		 									'invoiceID' => $invoice->invoiceID,
 		 									'feetypeID' => $bundlefeetype_feetype->feetypesID,
 		 									'feetype' => $bundlefeetype_feetype->feetypes,
 		 									'amount' => $bundlefeetype_feetype->amount,
 		 									'date' => $invoice->date
 		 								];
 		 								$result = $this->invoiceAndBilling($student, $array);
 		 						}
@@ -244,55 +259,57 @@ class Quickbooks extends Admin_Controller {
 						if(isset($result['error']))
 							$retArray['error'] = $result['error'];
 						$results[] = $retArray;
 				 }
 			 }
 			 elseif($type == "payment") {
 				 foreach ($ids as $id) {
 					  $payment = $this->payment_m->get_single_payment(array('paymentID' => $id, 'schoolID' => $schoolID));
 					 	$student = $this->student_m->get_student($payment->studentID);
 	 					$result = $this->createPayment($student, $payment);
 
 						$retArray['status'] = $result['status'];
 						$retArray['id'] = $payment->paymentID;
 						if(isset($result['error']))
 							$retArray['error'] = $result['error'];
 						$results[] = $retArray;
 				 }
 			 }
 		 }
 
 		 echo json_encode($results);
 		 exit;
 	}
 
   public function callback() {
+    $this->ensureQuickbooksSdkReady();
     $result = $this->processCode();
   }
 
   function processCode()  {
-		$schoolID = $this->session->userdata('schoolID');
+        $this->ensureQuickbooksSdkReady();
+                $schoolID = $this->session->userdata('schoolID');
     // Create SDK instance
     $config = $this->quickbooksConfig();
 
     $dataService = DataService::Configure(array(
         'auth_mode' => 'oauth2',
         'ClientID' => $config['client_id'],
         'ClientSecret' =>  $config['client_secret'],
         'RedirectURI' => base_url() . "quickbooks/callback",
         'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
         'baseUrl' => $config['stage']
     ));
 
     $OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
     $parseUrl = $this->parseAuthRedirectUrl($_SERVER['QUERY_STRING']);
 
     /*
     * Update the OAuth2Token
     */
     $accessToken = $OAuth2LoginHelper->exchangeAuthorizationCodeForToken($parseUrl['code'], $parseUrl['realmId']);
     $dataService->updateOAuth2Token($accessToken);
 
 		try {
 			$companyinfoArray = $dataService->Query("select * from CompanyInfo");
 			$this->quickbookslog_m->insert_quickbookslog(array("ip" => $_SERVER['REMOTE_ADDR'], "request" => "select * from CompanyInfo", "status" => "OK", 'schoolID' => $schoolID));
 		} catch (Exception $e) {
@@ -370,52 +387,53 @@ class Quickbooks extends Admin_Controller {
 		$customerName = $student->srstudentID ."-". $student->srname;
 
 		try {
 			$customerArray = $dataService->Query("select * from Customer where DisplayName='" . addslashes($customerName) . "'");
 			if (is_array($customerArray) && sizeof($customerArray) > 0) {
 					$creditmemoArray = $dataService->Query("select * from Creditmemo WHERE CustomerRef='" . $customerArray[0]->Id . "'");
 					foreach($creditmemoArray as $creditmemo) {
 						$totalAmount += $creditmemo->TotalAmt;
 					}
 			}
 		}
 		catch (Exception $e) {}
 		catch (SdkException $e) {}
 
 		return $totalAmount;
 	}
 
   function parseAuthRedirectUrl($url) {
     parse_str($url,$qsArray);
     return array(
         'code' => $qsArray['code'],
         'realmId' => $qsArray['realmId']
     );
   }
 
-	function refreshToken()
-	{
+        function refreshToken()
+        {
+                $this->ensureQuickbooksSdkReady();
      /*
      * Retrieve the accessToken value from session variable
      */
 		$schoolID = $this->session->userdata('schoolID');
 		$config = $this->quickbooksConfig();
 
  		$accessToken = unserialize($config['sessionAccessToken']);
     $oauth2LoginHelper = new OAuth2LoginHelper($accessToken->getclientID(),$accessToken->getClientSecret());
     $newAccessTokenObj = $oauth2LoginHelper->
                     refreshAccessTokenWithRefreshToken($accessToken->getRefreshToken());
     $newAccessTokenObj->setRealmID($accessToken->getRealmID());
     $newAccessTokenObj->setBaseURL($accessToken->getBaseURL());
 		$sessionAccessTokenExpiry = now()+60*60;
 
     $dataService = DataService::Configure(array(
         'auth_mode' => 'oauth2',
         'ClientID' => $config['client_id'],
         'ClientSecret' =>  $config['client_secret'],
         'RedirectURI' => base_url() . "quickbooks/callback",
         'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
         'baseUrl' => $config['stage']
     ));
 
 		/*
 		* Update the OAuth2Token of the dataService object
@@ -1001,52 +1019,53 @@ class Quickbooks extends Admin_Controller {
 					if ($error) {
 						logError($error);
 						$retArray['error']  = $error;
 						$retArray['status'] = FALSE;
 						$result = $retArray;
 					}
 				}
 			}
 		}
 
 		return $result;
 	}
 
 	function updateInvoice($invoiceID) {
 		$this->invoice_m->update_invoice(['quickbooks_status' => 1], $invoiceID);
 	}
 
 	function updateCreditmemo($creditmemoID) {
 		$this->creditmemo_m->update_creditmemo(['quickbooks_status' => 1], $creditmemoID);
 	}
 
 	function updatePayment($paymentID) {
 		$this->payment_m->update_payment(['quickbooks_status' => 1], $paymentID);
 	}
 
-	public function download() {
-		$filename = 'quickbooks-logs.zip';
+        public function download() {
+                $this->ensureQuickbooksSdkReady();
+                $filename = 'quickbooks-logs.zip';
 		// Get real path for our folder
 		$path = APPPATH . '../mvc/logs/quickbooks';
 		$rootPath = realpath($path);
 
 		// Initialize archive object
 		$zip = new ZipArchive();
 		$zip->open($filename, ZipArchive::CREATE | ZipArchive::OVERWRITE);
 
 		// Create recursive directory iterator
 		/** @var SplFileInfo[] $files */
 		$files = new RecursiveIteratorIterator(
     	new RecursiveDirectoryIterator($rootPath),
     	RecursiveIteratorIterator::LEAVES_ONLY
 		);
 
 		foreach ($files as $name => $file)
 		{
     	// Skip directories (they would be added automatically)
     	if (!$file->isDir())
     	{
         // Get real and relative path for current file
         $filePath = $file->getRealPath();
         $relativePath = substr($filePath, strlen($rootPath) + 1);
 
         // Add current file to archive
diff --git a/mvc/controllers/Quickbookssettings.php b/mvc/controllers/Quickbookssettings.php
index aa1ec95bc02698b7e55a13cf6dd0aea48aa5c51a..ad02347df8e61e0bc2c6df38c938ee6596762630 100644
--- a/mvc/controllers/Quickbookssettings.php
+++ b/mvc/controllers/Quickbookssettings.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 
 class Quickbookssettings extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 
     $this->load->model('quickbookssettings_m');
     $language = $this->session->userdata('lang');
 		$this->lang->load('quickbookssettings', $this->session->userdata('lang'));
   }
 
   protected function rules() {
@@ -31,79 +33,80 @@ class Quickbookssettings extends Admin_Controller {
 				'label' => $this->lang->line("quickbookssettings_client_id"),
 				'rules' => 'trim|xss_clean|max_length[255]|required'
 			),
 			array(
 				'field' => 'client_secret',
 				'label' => $this->lang->line("quickbookssettings_client_secret"),
 				'rules' => 'trim|xss_clean|max_length[255]|required'
 			)
 		);
 		return $rules;
 	}
 
   public function index() {
 		$this->data['headerassets'] = [
 			 'css' => [
 					 'assets/select2/css/select2.css',
 					 'assets/select2/css/select2-bootstrap.css'
 			 ],
 			 'js'  => [
 					 'assets/select2/select2.js'
 			 ]
 		];
 
 		$schoolID = $this->session->userdata('schoolID');
 		$array = array('client_id', 'client_secret', 'stage', 'active');
-		$config = $this->quickbooksConfig();
-		$quickbookssettings = $this->quickbookssettings_m->get_quickbooksetting_values(array('schoolID' => $schoolID));
-		$i = 0;
+                $config = $this->quickbooksConfig();
+                $quickbookssettings = $this->quickbookssettings_m->get_quickbooksetting_values(array('schoolID' => $schoolID));
+                $i = 0;
 		foreach($quickbookssettings as $quickbookssetting) {
 				if(!in_array($quickbookssetting->field_names, $array)) {
 					unset($quickbookssettings[$i]);
 				}
 				$i++;
 		}
-		$this->data['set_quickbooks'] = $quickbookssettings;
-		$this->data['config'] = $config;
+                $this->data['set_quickbooks'] = $quickbookssettings;
+                $this->data['config'] = $config;
+                $this->data['authUrl'] = '';
 
-		if($config['client_id'] != "" && $config['client_secret'] != "" && ($config['stage'] == "development" || $config['stage'] == "production")) {
-			$dataService = DataService::Configure(array(
-					'auth_mode' => 'oauth2',
-					'ClientID' => $config['client_id'],
+                if(quickbooks_sdk_available() && $config['client_id'] != "" && $config['client_secret'] != "" && ($config['stage'] == "development" || $config['stage'] == "production")) {
+                        $dataService = DataService::Configure(array(
+                                        'auth_mode' => 'oauth2',
+                                        'ClientID' => $config['client_id'],
 					'ClientSecret' =>  $config['client_secret'],
 					'RedirectURI' => base_url() . "quickbooks/callback",
 					'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 					'baseUrl' => $config['stage']
 			));
 
 			$OAuth2LoginHelper = $dataService->getOAuth2LoginHelper();
 			$authUrl = $OAuth2LoginHelper->getAuthorizationCodeURL();
 
 			// Store the url in PHP Session Object;
-			$_SESSION['authUrl'] = $authUrl;
-			$this->data["authUrl"] = $authUrl;
-		}
+                        $_SESSION['authUrl'] = $authUrl;
+                        $this->data["authUrl"] = $authUrl;
+                }
 
     if($_POST) {
 				$rules = $this->rules();
 				$this->form_validation->set_rules($rules);
 				if ($this->form_validation->run() == FALSE) {
 					$this->data["subview"] = "quickbookssettings/index";
 					$this->load->view('_layout_main', $this->data);
 				} else {
 					$clientID = $this->input->post('client_id');
 					$secret = $this->input->post('client_secret');
 					$stage = $this->input->post('stage');
 					$active = $this->input->post('active');
 
 					$array = array(
 					   array(
 					      'quickbookssettingsID'  => 1,
 					      'field_values' => $clientID,
 								'schoolID'     => $schoolID
 					   ),
 					   array(
 					      'quickbookssettingsID'  => 2,
 					      'field_values' => $secret,
 								'schoolID'     => $schoolID
 					   ),
 						 array(
diff --git a/mvc/controllers/Safaricom.php b/mvc/controllers/Safaricom.php
index ee96ab30370bf8a5b543e71df8d4703418e13c9b..3f17d9322a65c8c9b7cba58a08fcfabf7a28b8a8 100644
--- a/mvc/controllers/Safaricom.php
+++ b/mvc/controllers/Safaricom.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Core\OAuth\OAuth2\OAuth2LoginHelper;
 use QuickBooksOnline\API\Facades\Customer;
 use QuickBooksOnline\API\Facades\Payment;
 use QuickBooksOnline\API\Core\Http\Serialization\XmlObjectSerializer;
 
 class Safaricom extends CI_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct() {
 		parent::__construct();
 
 		$this->load->model('mainmpesa_m');
 		$this->load->model('mpesa_m');
@@ -286,59 +288,63 @@ class Safaricom extends CI_Controller {
 				$this->mailandsms_m->insert_mailandsms($array);
 			}
 
 			//open text file for logging messages by appending
 			$file = fopen($filePath, "a");
 			//log incoming request
 			fwrite($file, $postData);
 			fwrite($file, "\r\n");
 		} catch(Exception $ex){
 			//append exception to file
 			$logErr = fopen($errorLog, "a");
 			fwrite($logErr, $ex->getMessage());
 			fwrite($logErr, "\r\n");
 			fclose($logErr);
 
 			//set failure response
 			$resp ='{"ResultCode": 1, "ResultDesc":"Validation failure due to internal service error"}';
 		}
 
 		//log response and close file
 		fwrite($file, $resp);
 		fclose($file);
 
 	}
 
-	function createPayment($student, $payment, $id)
-	{
-		/*  This sample performs the following functions:
-		1.   Add a customer
-		2    Create payment using the information above
-		*/
+        function createPayment($student, $payment, $id)
+        {
+                /*  This sample performs the following functions:
+                1.   Add a customer
+                2    Create payment using the information above
+                */
+
+                if(!quickbooks_sdk_available()) {
+                        return;
+                }
 
-		// Create SDK instance
-		$config = array();
+                // Create SDK instance
+                $config = array();
 		$get_quickbooks = $this->quickbookssettings_m->get_order_by_quickbooksettings();
 		foreach($get_quickbooks as $key => $value) {
 			$config[$value->field_names] = $value->field_values;
 		}
 		$dataService = DataService::Configure(array(
 			'auth_mode' => 'oauth2',
 			'ClientID' => $config['client_id'],
 			'ClientSecret' =>  $config['client_secret'],
 			'RedirectURI' => base_url() . "quickbooks/callback",
 			'scope' => 'com.intuit.quickbooks.accounting openid profile email phone address',
 			'baseUrl' => $config['stage']
 		));
 
 		/*
 		* Retrieve the accessToken value from session variable
 		*/
 		if(now() > $config['sessionAccessTokenExpiry'])
 			$accessToken = $this->refreshToken();
 		else
 		  $accessToken = unserialize($config['sessionAccessToken']);
 		$dataService->throwExceptionOnError(true);
 
 		/*
 		* Update the OAuth2Token of the dataService object
 		*/
diff --git a/mvc/controllers/Student.php b/mvc/controllers/Student.php
index f874f9fd7cb8e25e0902dafe9ca21d99b315fea5..7769376cd06a3cc4aeec8f451442b17c864a3a30 100644
--- a/mvc/controllers/Student.php
+++ b/mvc/controllers/Student.php
@@ -1,27 +1,29 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Facades\Customer;
 
 class Student extends Admin_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	function __construct () {
 		parent::__construct();
 		$this->load->model("student_m");
 		$this->load->model("parents_m");
 		$this->load->model("section_m");
 		$this->load->model("classes_m");
 		$this->load->model("setting_m");
 		$this->load->model('studentrelation_m');
diff --git a/mvc/controllers/Student_statement.php b/mvc/controllers/Student_statement.php
index 77f3d217f356d57a33e0cc169705400b663bdf78..d7b239fb49a091536e1505595d0a09bbe7e5ebbf 100644
--- a/mvc/controllers/Student_statement.php
+++ b/mvc/controllers/Student_statement.php
@@ -1,28 +1,30 @@
 <?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
 require_once(APPPATH . 'libraries/PaymentGateway/PaymentGateway.php');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 use QuickBooksOnline\API\DataService\DataService;
 use QuickBooksOnline\API\Facades\Customer;
 use QuickBooksOnline\API\Facades\Payment;
 use QuickBooksOnline\API\Core\Http\Serialization\XmlObjectSerializer;
 
 class Student_statement extends Admin_Controller
 {
     /*
     | -----------------------------------------------------
     | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
     | -----------------------------------------------------
     | AUTHOR:			INILABS TEAM
     | -----------------------------------------------------
     | EMAIL:			info@inilabs.net
     | -----------------------------------------------------
     | COPYRIGHT:		RESERVED BY INILABS IT
     | -----------------------------------------------------
     | WEBSITE:			http://inilabs.net
     | -----------------------------------------------------
     */
 
     public $payment_gateway;
 
     function __construct() {
         parent::__construct();
diff --git a/mvc/controllers/Test.php b/mvc/controllers/Test.php
index 59ff3c6cfaf43e0b4a7d0985070781036f1cf8fc..c2daceef0d804f3b5fc796be9488b4f7b561cf5e 100644
--- a/mvc/controllers/Test.php
+++ b/mvc/controllers/Test.php
@@ -1,28 +1,30 @@
 <?php
 if ( ! defined('BASEPATH')) exit('No direct script access allowed');
-require_once(APPPATH . '../vendor/autoload.php');
+if(file_exists(APPPATH . '../vendor/autoload.php')) {
+    require_once(APPPATH . '../vendor/autoload.php');
+}
 /*foreach (new DirectoryIterator($_SERVER['DOCUMENT_ROOT'] . '/shule/mvc/controllers/api/v10') as $fileInfo) {
 	if($fileInfo->isDot()) continue;
 	$filename = "api/v10/". $fileInfo->getFilename();
 	if(str_ends_with($filename, 'php'))
 		require_once $filename;
 }*/
 
 class Test extends Admin_Controller {
 // class Test extends CI_Controller {
 /*
 | -----------------------------------------------------
 | PRODUCT NAME: 	INILABS SCHOOL MANAGEMENT SYSTEM
 | -----------------------------------------------------
 | AUTHOR:			INILABS TEAM
 | -----------------------------------------------------
 | EMAIL:			info@inilabs.net
 | -----------------------------------------------------
 | COPYRIGHT:		RESERVED BY INILABS IT
 | -----------------------------------------------------
 | WEBSITE:			http://inilabs.net
 | -----------------------------------------------------
 */
 	public function __construct()
 	{
 		parent::__construct();
diff --git a/mvc/helpers/action_helper.php b/mvc/helpers/action_helper.php
index 2e7ef30b230c09a8a48c715b05268c1064fc2c87..59082cd5253ef901417d117ec1bb8df235323166 100644
--- a/mvc/helpers/action_helper.php
+++ b/mvc/helpers/action_helper.php
@@ -132,50 +132,70 @@
     {
         return anchor($uri, "<i class='fa fa-trash-o'></i>",
             [
                 'onclick'             => "return confirm('you are about to delete a record. This cannot be undone. are you sure?')",
                 'class'               => 'btn btn-danger btn-xs mrg',
                 'data-placement'      => 'top',
                 'data-toggle'         => 'tooltip',
                 'data-original-title' => $name
             ]
         );
     }
 
     function btn_cancel( $uri, $name )
     {
         return anchor($uri, "<i class='fa fa-close'></i>",
             [
                 'onclick'             => "return confirm('you are about to cancel the record. This cannot be undone. are you sure?')",
                 'class'               => 'btn btn-danger btn-xs mrg',
                 'data-placement'      => 'top',
                 'data-toggle'         => 'tooltip',
                 'data-original-title' => $name
             ]
         );
     }
 
+    if(!function_exists('quickbooks_sdk_available')) {
+        function quickbooks_sdk_available() {
+            static $available = null;
+
+            if($available === null) {
+                $available = false;
+                $autoloadPath = APPPATH . '../vendor/autoload.php';
+
+                if(file_exists($autoloadPath)) {
+                    require_once $autoloadPath;
+                    if(class_exists('QuickBooksOnline\\API\\DataService\\DataService')) {
+                        $available = true;
+                    }
+                }
+            }
+
+            return $available;
+        }
+    }
+
 
     function delete_file( $uri, $id )
     {
         return anchor($uri, "<i class='fa fa-times '></i>",
             [
                 'onclick' => "return confirm('you are about to delete a record. This cannot be undone. are you sure?')",
                 'id'      => $id,
                 'class'   => "close pull-right"
             ]
         );
     }
 
     function share_file( $uri, $id )
     {
         return anchor($uri, "<i class='fa fa-globe'></i>",
             [
                 'onclick' => "return confirm('you are about to delete a record. This cannot be undone. are you sure?')",
                 'id'      => $id,
                 'class'   => "pull-right"
             ]
         );
     }
 
 
     function btn_dash_view( $uri, $name, $class = "btn-success" )
diff --git a/mvc/libraries/Admin_Controller.php b/mvc/libraries/Admin_Controller.php
index 078d3341c18d0b20433ee68ae474d886258a5aac..1e9990963ad8ecaf0d8026981891eed3931d98df 100644
--- a/mvc/libraries/Admin_Controller.php
+++ b/mvc/libraries/Admin_Controller.php
@@ -976,35 +976,50 @@ class Admin_Controller extends MY_Controller {
             '4' => 'Thursday',
             '5' => 'Friday',
             '6' => 'Saturday'
         );
 
         $weekendDay = $this->data['siteinfos']->weekends;
         $weekendArrays = explode(',', $weekendDay);
 
         $weekendDateArrays = array();
 
         for($i= $date_from; $i<= $date_to; $i= $i+$oneDay) {
             if($weekendDay != "") {
                 foreach($weekendArrays as $weekendValue) {
                     if($weekendValue >= 0 && $weekendValue <= 6) {
                         if(date('l',$i) == $allDays[$weekendValue]) {
                             $weekendDateArrays[] = date('d-m-Y', $i);
                         }
                     }
                 }
             }
         }
         return $weekendDateArrays;
     }
 
     public function quickbooksConfig()
-  	{
-  		$config = array();
-  		$get_quickbooks = $this->quickbookssettings_m->get_quickbooksetting_values(array('schoolID' => $this->session->userdata('schoolID')));
-  		foreach ($get_quickbooks as $key => $value) {
-  			$config[$value->field_names] = $value->field_values;
-  		}
+        {
+                $config = array();
+                $get_quickbooks = $this->quickbookssettings_m->get_quickbooksetting_values(array('schoolID' => $this->session->userdata('schoolID')));
+                foreach ($get_quickbooks as $key => $value) {
+                        $config[$value->field_names] = $value->field_values;
+                }
 
-  		return $config;
-  	}
+                $defaults = array(
+                        'client_id'               => '',
+                        'client_secret'           => '',
+                        'stage'                   => 'development',
+                        'active'                  => '0',
+                        'sessionAccessToken'      => '',
+                        'sessionAccessTokenExpiry'=> 0,
+                );
+
+                $config = array_merge($defaults, $config);
+
+                if(!quickbooks_sdk_available()) {
+                        $config['active'] = '0';
+                }
+
+                return $config;
+        }
 }
diff --git a/mvc/libraries/Bongasms.php b/mvc/libraries/Bongasms.php
index 71cd7a66cba0a439226ece738958bd76c63c661a..f4658683d1a97b1bc6d23755a619397a48faa82c 100644
--- a/mvc/libraries/Bongasms.php
+++ b/mvc/libraries/Bongasms.php
@@ -1,65 +1,85 @@
 <?php if ( !defined('BASEPATH') ) {
     exit('No direct script access allowed');
 }
 
 class Bongasms
 {
-	protected $senderID;
+        protected $senderID;
   protected $clientID;
   protected $key;
   protected $secret;
+  protected $configured = false;
 
   public function __construct()
   {
     $this->ci =& get_instance();
     $this->ci->load->model('smssettings_m');
 
     $bongasms_bind = [];
     $get_bongasms = $this->ci->smssettings_m->get_order_by_bongasms(array('types' => 'bongasms', 'schoolID' => $this->ci->session->userdata('schoolID')));
     foreach ( $get_bongasms as $key => $value ) {
       $bongasms_bind[ $value->field_names ] = $value->field_values;
     }
-    $this->clientID = $bongasms_bind['bongasms_api_clientID'];
-    $this->key = $bongasms_bind['bongasms_api_key'];
-    $this->secret = $bongasms_bind['bongasms_api_secret'];
+    $this->clientID = isset($bongasms_bind['bongasms_api_clientID']) ? $bongasms_bind['bongasms_api_clientID'] : '';
+    $this->key = isset($bongasms_bind['bongasms_api_key']) ? $bongasms_bind['bongasms_api_key'] : '';
+    $this->secret = isset($bongasms_bind['bongasms_api_secret']) ? $bongasms_bind['bongasms_api_secret'] : '';
+    $this->configured = ($this->clientID !== '' && $this->key !== '' && $this->secret !== '');
   }
 
   public function send( $to, $message )
   {
+    if(!$this->configured) {
+      log_message('debug', 'Bongasms send skipped: gateway not configured.');
+      return false;
+    }
 
     $url = "http://167.172.14.50:4002/v1/send-sms";
     $post_data = http_build_query([
       "apiClientID" => $this->clientID,
       "key" => $this->key,
       "secret" => $this->secret,
       "txtMessage" => $message,
       "MSISDN" => $to
     ]);
 
     $curl = curl_init();
     curl_setopt($curl, CURLOPT_URL, $url);
     curl_setopt($curl, CURLOPT_POST, 1);
     curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded '));
     curl_setopt($curl, CURLOPT_POSTFIELDS, $post_data);
     curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
     $result = curl_exec($curl);
 
+    if($result === false) {
+      log_message('error', 'Bongasms cURL error: ' . curl_error($curl));
+      return false;
+    }
+
     $result = json_decode($result);
     return $result;
   }
 
   public function delivery_report( $message_uuid )
   {
+    if(!$this->configured) {
+      log_message('debug', 'Bongasms delivery report skipped: gateway not configured.');
+      return false;
+    }
 
     $url = "https://app.bongasms.co.ke/api/fetch-delivery?apiClientID=". $this->clientID ."&key=". $this->key ."&unique_id=". $message_uuid;
 
     $curl = curl_init();
     curl_setopt($curl, CURLOPT_URL, $url);
     curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded '));
     curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
     $result = curl_exec($curl);
 
+    if($result === false) {
+      log_message('error', 'Bongasms delivery report error: ' . curl_error($curl));
+      return false;
+    }
+
     $result = json_decode($result);
     return $result;
   }
 }
diff --git a/mvc/libraries/Bulk.php b/mvc/libraries/Bulk.php
index 78d40b8a51f199c17c9fe50dccd1361513b74e7d..c22c7bd5aad3528d818089dc97d0f0a3c74b9137 100644
--- a/mvc/libraries/Bulk.php
+++ b/mvc/libraries/Bulk.php
@@ -1,78 +1,88 @@
 <?php if ( !defined('BASEPATH') ) {
     exit('No direct script access allowed');
 }
 
 class Bulk
 {
 
     protected $username;
     protected $password;
     protected $url;
     protected $port;
+    protected $configured = false;
 
     public function __construct()
     {
         $this->ci =& get_instance();
         $this->ci->load->model('smssettings_m');
 
         $bulk_bind = [];
         $get_bulks = $this->ci->smssettings_m->get_order_by_bulk();
         foreach ( $get_bulks as $key => $get_bulk ) {
             $bulk_bind[ $get_bulk->field_names ] = $get_bulk->field_values;
         }
 
-        $this->username = $bulk_bind['bulk_username'];
-        $this->password = $bulk_bind['bulk_password'];
+        $this->username = isset($bulk_bind['bulk_username']) ? $bulk_bind['bulk_username'] : '';
+        $this->password = isset($bulk_bind['bulk_password']) ? $bulk_bind['bulk_password'] : '';
         $this->url      = 'https://bulksms.vsms.net/eapi/submission/send_sms/2/2.0';
         $this->port     = 443;
+        $this->configured = ($this->username !== '' && $this->password !== '');
     }
 
     public function show()
     {
         dump($this->username);
     }
 
     public function ping()
     {
+        if(!$this->configured) {
+            log_message('debug', 'Bulk SMS ping skipped: gateway not configured.');
+            return false;
+        }
         $pingurl = 'https://bulksms.vsms.net/eapi/submission/send_sms/2/2.0';
         $ch      = curl_init();
         curl_setopt($ch, CURLOPT_URL, $pingurl);
         curl_setopt($ch, CURLOPT_POST, 1);
         curl_setopt($ch, CURLOPT_POSTFIELDS, 'username=' . $this->username . '&password=' . $this->password);
         curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
         $result = curl_exec($ch);
         curl_close($ch);
         $exp = explode("|", $result);
         if ( $exp[0] == 23 ) {
             return false;
         }
         return true;
     }
 
     public function send( $to, $message )
     {
+        if(!$this->configured) {
+            log_message('debug', 'Bulk SMS send skipped: gateway not configured.');
+            return false;
+        }
         $post_body = $this->unicode_sms($this->username, $this->password, $message, $to);
         $result    = $this->send_message($post_body, $this->url, $this->port);
         if ( $result['success'] ) {
             return true;
         } else {
             return false;
         }
     }
 
     public function unicode_sms( $username, $password, $message, $msisdn )
     {
         $post_fields = [
             'username' => $username,
             'password' => $password,
             'message'  => $this->string_to_utf16_hex($message),
             'msisdn'   => $msisdn,
             'dca'      => '16bit'
         ];
         return $this->make_post_body($post_fields);
     }
 
     function string_to_utf16_hex( $string )
     {
         return bin2hex(mb_convert_encoding($string, "UTF-16", "UTF-8"));
     }
diff --git a/mvc/libraries/Clickatell.php b/mvc/libraries/Clickatell.php
index 8aeeb89d2da95c31346485300b90056c9c87a686..095c7b2bbfb8bf711f2fd5ae26451af0718d445d 100644
--- a/mvc/libraries/Clickatell.php
+++ b/mvc/libraries/Clickatell.php
@@ -2,181 +2,203 @@
 
 /**
  * Clickatell Class
  *
  * @package		Clickatell
  * @subpackage	Libraries
  * @category	SMS Gateway
  * @author		Zachie du Bruyn
  */
 class Clickatell
 {
     const ERR_NONE              = 0;
     const ERR_AUTH_FAIL         = 1;
     const ERR_SEND_MESSAGE_FAIL = 2;
     const ERR_SESSION_EXPIRED   = 3;
     const ERR_PING_FAIL         = 4;
     const ERR_CALL_FAIL         = 5;
 
     // public vars
     public $error = SELF::ERR_NONE;
     public $error_message = '';
 
     // private vars
     private $ci;
     private $session_id = FALSE;
+    private $configured = false;
 
     const BASEURL = "http://api.clickatell.com";
 
     /**
      * Class constructor - loads CodeIgnighter and Configs
      */
     public function __construct()
     {
         $this->ci =& get_instance();
 
         $this->ci->load->model('smssettings_m');
         $this->ci->load->model("site_m");
         $siteinfo = $this->ci->site_m->get_site(1, "TRUE");
         
         $clickatell_bind = array();
         $get_clickatells = $this->ci->smssettings_m->get_order_by_clickatell();
         foreach ($get_clickatells as $key => $get_clickatell) {
             $clickatell_bind[$get_clickatell->field_names] = $get_clickatell->field_values;
         }
 
 
-        $this->username = $clickatell_bind['clickatell_username'];
-        $this->password = $clickatell_bind['clickatell_password'];
-        $this->api_id   = $clickatell_bind['clickatell_api_key'];
+        $this->username = isset($clickatell_bind['clickatell_username']) ? $clickatell_bind['clickatell_username'] : '';
+        $this->password = isset($clickatell_bind['clickatell_password']) ? $clickatell_bind['clickatell_password'] : '';
+        $this->api_id   = isset($clickatell_bind['clickatell_api_key']) ? $clickatell_bind['clickatell_api_key'] : '';
         $this->from_no  = $siteinfo->phone;
+        $this->configured = ($this->username !== '' && $this->password !== '' && $this->api_id !== '');
     }
 
     /**
      * Method for Authentication with Clickatell
      *
      * @return string $session_id
-     */
+        */
     public function authenticate()
     {
+        if(!$this->configured) {
+            $this->error = self::ERR_AUTH_FAIL;
+            $this->error_message = 'Gateway not configured.';
+            return FALSE;
+        }
         $url = self::BASEURL.'/http/auth?user='.$this->username
              . '&password='.$this->password.'&api_id='.$this->api_id;
 
         $result = $this->_do_api_call($url);
         $result = explode(':',$result);
 
         if ($result[0] == 'OK')
         {
             $this->session_id = trim($result[1]);
             return $this->session_id;
         }
         else
         {
             $this->error = self::ERR_AUTH_FAIL;
             $this->error_message = $result[0];
             return FALSE;
         }
     }
 
     /**
      * Method to send a text message to number
      *
      * @access  public
      * @param   string $to
      * @param   string $message
      * @return  message_id
      */
     public function send_message($to, $message)
     {
+        if(!$this->configured) {
+            $this->error = self::ERR_SEND_MESSAGE_FAIL;
+            $this->error_message = 'Gateway not configured.';
+            return FALSE;
+        }
         if ($this->session_id == FALSE)
         {
             $this->authenticate();
         }
 
         if ($this->error == self::ERR_NONE)
         {
             $message = urlencode($message);
             $url = self::BASEURL.'/http/sendmsg?session_id='.$this->session_id
                 . '&to='.$to.'&text='.$message.'&from='.$this->from_no.'&MO=1';
 
             $result = $this->_do_api_call($url);
             $result = explode(':',$result);
 
             if ($result[0] == 'ID')
             {
                 $api_message_id = $result[1];
                 return $api_message_id;
             }
             else
             {
                 $this->error = self::ERR_SEND_MESSAGE_FAIL;
                 $this->error_message = $result[0];
                 return FALSE;
             }
         }
         else
         {
             return FALSE;
         }
     }
     
     
     public function get_balance()
     {
+        if(!$this->configured) {
+            $this->error = self::ERR_CALL_FAIL;
+            $this->error_message = 'Gateway not configured.';
+            return FALSE;
+        }
         if ($this->session_id == FALSE)
         {
             $this->authenticate();
         }
 
         if ($this->error == self::ERR_NONE)
         {
             $url = self::BASEURL.'/http/getbalance?session_id='.$this->session_id;
             
             $result = $this->_do_api_call($url);
             $result = explode(':',$result);
             
             if ($result[0] == 'Credit')
             {
                 return (float)$result[1];
             }
             else
             {
                 $this->error = self::ERR_CALL_FAIL;
                 $this->error_message = $result[0];
                 return FALSE;
             }
         }       
     }
     
     /**
      * Method to send a ping to keep session live
      *
      * @access  public
      * @return  bool $success
      */
     public function ping()
     {
+        if(!$this->configured) {
+            $this->error = self::ERR_PING_FAIL;
+            $this->error_message = 'Gateway not configured.';
+            return FALSE;
+        }
         if ($this->session_id == FALSE)
         {
             $this->authenticate();
         }
 
         if ($this->error == self::ERR_NONE)
         {   
             $url = self::BASEURL.'/http/ping?session_id='.$this->session_id;
             
             $result = $this->_do_api_call($url);
             $result = explode(':',$result);
             
             if ($result[0] == 'OK')
             {
                 return TRUE;
             }
             else
             {
                 $this->error = self::ERR_PING_FAIL;
                 $this->error_message = $result[0];
                 return FALSE;
             }
         }
     }
     
diff --git a/mvc/libraries/Msg91.php b/mvc/libraries/Msg91.php
index a87d21a7fa20b26e891df27884e29c08825425e0..185e7b0e3159584919f44e651b5726423fcd6b48 100644
--- a/mvc/libraries/Msg91.php
+++ b/mvc/libraries/Msg91.php
@@ -1,50 +1,56 @@
 <?php if ( !defined('BASEPATH') ) {
     exit('No direct script access allowed');
 }
 
 class Msg91
 {
     protected $authKey;
     protected $senderID;
+    protected $configured = false;
 
     public function __construct()
     {
         $this->ci =& get_instance();
         $this->ci->load->model('smssettings_m');
 
         $msg91_bind = [];
         $get_msg91s = $this->ci->smssettings_m->get_order_by_msg91();
         foreach ( $get_msg91s as $key => $get_msg91 ) {
             $msg91_bind[ $get_msg91->field_names ] = $get_msg91->field_values;
         }
-        $this->authKey  = $msg91_bind['msg91_authKey'];
-        $this->senderID = $msg91_bind['msg91_senderID'];
+        $this->authKey  = isset($msg91_bind['msg91_authKey']) ? $msg91_bind['msg91_authKey'] : '';
+        $this->senderID = isset($msg91_bind['msg91_senderID']) ? $msg91_bind['msg91_senderID'] : '';
+        $this->configured = ($this->authKey !== '' && $this->senderID !== '');
     }
 
     public function send( $to, $message )
     {
+        if(!$this->configured) {
+            log_message('debug', 'MSG91 send skipped: gateway not configured.');
+            return false;
+        }
         //Your message to send, Add URL encoding here.
         $message = urlencode($message);
 
         //Define route
         $route   = 4;
         $country = 0;
         //Prepare you post parameters
         $postData = [
             'mobiles' => $to,
             'message' => $message,
             'authkey' => $this->authKey,
             'sender'  => $this->senderID,
             'route'   => $route,
             'country' => $country
         ];
 
         $url = "http://api.msg91.com/api/sendhttp.php";
 
         // init the resource
         $ch = curl_init();
         curl_setopt_array($ch, [
             CURLOPT_URL            => $url,
             CURLOPT_RETURNTRANSFER => true,
             CURLOPT_POST           => true,
             CURLOPT_POSTFIELDS     => $postData
diff --git a/mvc/libraries/Smsleopard.php b/mvc/libraries/Smsleopard.php
index e3e56c76f07d22d90a55e04ec12981ee09254612..b8b6980e9e6f57284560f12a5b461b0bc87d5948 100644
--- a/mvc/libraries/Smsleopard.php
+++ b/mvc/libraries/Smsleopard.php
@@ -1,78 +1,90 @@
 <?php if ( !defined('BASEPATH') ) {
     exit('No direct script access allowed');
 }
 
 class Smsleopard
 {
-	protected $senderID;
+        protected $senderID;
   protected $accountID;
   protected $secret;
+  protected $configured = false;
 
   public function __construct($params=[])
   {
     $this->ci =& get_instance();
     $this->ci->load->model('smssettings_m');
 
     $smsleopard_bind = [];
     $get_smsleopards = $this->ci->smssettings_m->get_order_by_smsleopard(array('types' => 'smsleopard', 'schoolID' => $params['schoolID']));
     foreach ( $get_smsleopards as $key => $get_smsleopard ) {
       $smsleopard_bind[ $get_smsleopard->field_names ] = $get_smsleopard->field_values;
     }
-    $this->senderID  = $smsleopard_bind['smsleopard_senderID'];
-    $this->accountID  = $smsleopard_bind['smsleopard_accountID'];
-    $this->secret = $smsleopard_bind['smsleopard_secret'];
+    $this->senderID  = isset($smsleopard_bind['smsleopard_senderID']) ? $smsleopard_bind['smsleopard_senderID'] : '';
+    $this->accountID  = isset($smsleopard_bind['smsleopard_accountID']) ? $smsleopard_bind['smsleopard_accountID'] : '';
+    $this->secret = isset($smsleopard_bind['smsleopard_secret']) ? $smsleopard_bind['smsleopard_secret'] : '';
+    $this->configured = ($this->senderID !== '' && $this->accountID !== '' && $this->secret !== '');
   }
 
   public function send( $to, $message )
   {
+    if(!$this->configured) {
+      log_message('debug', 'SMSLeopard send skipped: gateway not configured.');
+      return false;
+    }
 
     $auth = base64_encode($this->accountID . ":" . $this->secret);
 		$params = array(
 			"message" => $message,
 			"destination" => $to,
 			"source" => $this->senderID,
 		);
 		$url = "https://api.smsleopard.com/v1/sms/send?".http_build_query($params);
 		$ch = curl_init($url);
 		curl_setopt_array($ch, array(
 			CURLOPT_RETURNTRANSFER => TRUE,
 			CURLOPT_HTTPHEADER => array(
 				'Authorization: Basic ' . $auth,
 			),
 		));
 
-		$response = curl_exec($ch);
+                $response = curl_exec($ch);
 
-		if (curl_errno($ch)) {
-			echo "<br>errno==>" . curl_errno($ch);
-			echo "<br>error==>" . curl_error($ch);
-		}
-		curl_close($ch);
+                if (curl_errno($ch)) {
+                        log_message('error', 'SMSLeopard error: ' . curl_error($ch));
+                        curl_close($ch);
+                        return false;
+                }
+                curl_close($ch);
 
-		return $response;
+                return $response;
   }
 
   public function delivery_report( $message_uuid )
   {
+    if(!$this->configured) {
+      log_message('debug', 'SMSLeopard delivery report skipped: gateway not configured.');
+      return false;
+    }
 
     $auth = base64_encode($this->accountID . ":" . $this->secret);
     $url = "https://api.smsleopard.com/v1/delivery_reports/".$message_uuid;
 		$ch = curl_init($url);
 		curl_setopt_array($ch, array(
 			CURLOPT_RETURNTRANSFER => TRUE,
 			CURLOPT_HTTPHEADER => array(
 				'Authorization: Basic ' . $auth,
 			),
 		));
 
-		$response = curl_exec($ch);
+                $response = curl_exec($ch);
 
-		if (curl_errno($ch)) {
-			echo "<br>errno==>" . curl_errno($ch);
-			echo "<br>error==>" . curl_error($ch);
-		}
-		curl_close($ch);
+                if (curl_errno($ch)) {
+                        log_message('error', 'SMSLeopard delivery report error: ' . curl_error($ch));
+                        curl_close($ch);
+                        return false;
+                }
+                curl_close($ch);
 
-		return $response;
+                return $response;
   }
 }
diff --git a/mvc/libraries/Twilio.php b/mvc/libraries/Twilio.php
index 78ad2d077e3e362bcc3e511e7b72fbc3befc2418..1ffe7c43f2cd560f416a156530565b7e811b2736 100644
--- a/mvc/libraries/Twilio.php
+++ b/mvc/libraries/Twilio.php
@@ -1,103 +1,119 @@
 <?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');
 
 
 	class Twilio
 	{
 		protected $_ci;
 		protected $_twilio;
-		protected $mode;
-		protected $account_sid;
-		protected $auth_token;
-		protected $api_version;
-		protected $number;
+                protected $mode;
+                protected $account_sid;
+                protected $auth_token;
+                protected $api_version;
+                protected $number;
+                protected $configured = false;
 
 
 		function __construct()
 		{
 			//initialize the CI super-object
 			$this->_ci =& get_instance();
             $this->_ci->load->model('smssettings_m');
 
             $twilio_bind = array();
             $get_twilios = $this->_ci->smssettings_m->get_order_by_twilio();
             foreach ($get_twilios as $key => $get_twilio) {
                 $twilio_bind[$get_twilio->field_names] = $get_twilio->field_values;
             }
 
             $this->mode        = 'prod';
-            $this->account_sid = $twilio_bind['twilio_accountSID'];
-            $this->auth_token  = $twilio_bind['twilio_authtoken'];
+            $this->account_sid = isset($twilio_bind['twilio_accountSID']) ? $twilio_bind['twilio_accountSID'] : '';
+            $this->auth_token  = isset($twilio_bind['twilio_authtoken']) ? $twilio_bind['twilio_authtoken'] : '';
             $this->api_version = '2010-04-01';
-            $this->number      = $twilio_bind['twilio_fromnumber'];
+            $this->number      = isset($twilio_bind['twilio_fromnumber']) ? $twilio_bind['twilio_fromnumber'] : '';
 
 
-			//initialize the client
-			$this->_twilio = new TwilioRestClient($this->account_sid, $this->auth_token);
-		}
+                        //initialize the client
+                        if($this->account_sid !== '' && $this->auth_token !== '') {
+                                $this->_twilio = new TwilioRestClient($this->account_sid, $this->auth_token);
+                                $this->configured = true;
+                        } else {
+                                $this->_twilio = null;
+                                $this->configured = false;
+                        }
+                }
 
         public function get_twilio() {
             $array = array(
                 'mode' => $this->mode,
                 'accountSID' => $this->account_sid,
                 'authtoken' => $this->auth_token,
                 'version' => $this->api_version,
                 'number' => $this->number
 
             );
             return $array;
         }
 
 		/**
 		 * __call
 		 *
 		 * @desc Interface with rest client
 		 *
 		 */
-		public function __call($method, $arguments)
-		{
-			if (!method_exists( $this->_twilio, $method) )
-			{
-				throw new Exception('Undefined method Twilio::' . $method . '() called');
-			}
+                public function __call($method, $arguments)
+                {
+                        if(!$this->_twilio) {
+                                log_message('debug', 'Twilio client not configured.');
+                                return false;
+                        }
+
+                        if (!method_exists( $this->_twilio, $method) )
+                        {
+                                throw new Exception('Undefined method Twilio::' . $method . '() called');
+                        }
 
 			return call_user_func_array( array($this->_twilio, $method), $arguments);
 		}
 
 		/**
 		 * Send SMS
 		 *
 		 * @desc Send a basic SMS
 		 *
 		 * @param <int> Phone Number
 		 * @param <string> Text Message
 		 */
-		public function sms($from, $to, $message)
-		{
-			$url = '/' . $this->api_version . '/Accounts/' . $this->account_sid . '/SMS/Messages';
+                public function sms($from, $to, $message)
+                {
+                        if(!$this->configured) {
+                                log_message('debug', 'Twilio SMS skipped: gateway not configured.');
+                                return false;
+                        }
+                        $url = '/' . $this->api_version . '/Accounts/' . $this->account_sid . '/SMS/Messages';
 
-			$data = array(
+                        $data = array(
 				        'From'   => $from,
 				        'To'   => $to,
 				        'Body' => $message,
 			);
 
 			if ($this->mode == 'sandbox')
 				$data['From'] = $this->number;
 
 			return $this->_twilio->request($url, 'POST', $data);
 		}
 
 	}
 
 
 
     /*
     Copyright (c) 2009-2010 Twilio, Inc.
 
     Permission is hereby granted, free of charge, to any person
     obtaining a copy of this software and associated documentation
     files (the "Software"), to deal in the Software without
     restriction, including without limitation the rights to use,
     copy, modify, merge, publish, distribute, sublicense, and/or sell
     copies of the Software, and to permit persons to whom the
     Software is furnished to do so, subject to the following
