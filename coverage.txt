PHPUnit 10.5.58 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.14
Configuration: /workspaces/shulelabsci4/phpunit.xml

.........Starting CI4 users backfill from CI3 tables...
Table systemadmin does not exist, skipping.
Migrated 0 users from systemadmin
Table user does not exist, skipping.
Migrated 0 users from user
Table teacher does not exist, skipping.
Migrated 0 users from teacher
Table student does not exist, skipping.
Migrated 0 users from student
Table parents does not exist, skipping.
Migrated 0 users from parents
Total users migrated: 0
...................................................F..  63 / 206 ( 30%)
...........E..F.FFRF.FR.FFF.F........FF..................EF.FFF 126 / 206 ( 61%)
FFFFF....FEFEFFFFFF........EF.FFEEFFFF......................... 189 / 206 ( 91%)
.....EF.FFFFEFF.F                                               206 / 206 (100%)

Time: 00:03.798, Memory: 24.00 MB

There was 1 PHPUnit test runner warning:

1) XDEBUG_MODE=coverage (environment variable) or xdebug.mode=coverage (PHP configuration setting) has to be set

--

There were 9 errors:

1) Tests\Foundation\TenantTest::testTenantServiceExists
CodeIgniter\Database\Exceptions\DatabaseException: UNIQUE constraint failed: roles.id

/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseConnection.php:684
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:1841
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:2230
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:100
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:44

Caused by
CodeIgniter\Database\Exceptions\DatabaseException: UNIQUE constraint failed: roles.id

/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/SQLite3/Connection.php:181
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseConnection.php:729
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseConnection.php:646
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:1841
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:2230
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:100
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:44

Caused by
SQLite3Exception: UNIQUE constraint failed: roles.id

/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/SQLite3/Connection.php:175
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseConnection.php:729
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseConnection.php:646
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:1841
/workspaces/shulelabsci4/vendor/codeigniter4/framework/system/Database/BaseBuilder.php:2230
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:100
/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:44

2) Tests\Inventory\InventoryServiceTest::testAddAsset
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:35

3) Tests\Learning\LearningServiceTest::testCreateCourse
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:46

4) Tests\Learning\LearningServiceTest::testCreateAssignment
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:86

5) Tests\Library\LibraryServiceTest::testAddBook
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:35

6) Tests\Library\LibraryServiceTest::testReturnBook
ErrorException: Undefined array key "borrowing_id"

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:104

7) Tests\Library\LibraryServiceTest::testCannotReturnBookTwice
ErrorException: Undefined array key "borrowing_id"

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:125

8) Tests\Threads\ThreadsServiceTest::testSendMessage
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:35

9) Tests\Threads\ThreadsServiceTest::testCreateAnnouncement
ErrorException: Trying to access array offset on null

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:121

--

There were 44 failures:

1) Tests\Foundation\SchoolServiceTest::testGetDashboardStatsForSchool1
Failed asserting that 27 matches expected 25.

/workspaces/shulelabsci4/tests/Foundation/SchoolServiceTest.php:149

2) Tests\Foundation\TenantTest::testSwitchSchool
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:227

3) Tests\Foundation\TenantTest::testGetUserSchools
Failed asserting that actual size 0 matches expected size 1.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:248

4) Tests\Foundation\TenantTest::testHasAccessToSchool
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:258

5) Tests\Foundation\TenantTest::testTenantModelForSchool
Failed asserting that an array is not empty.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:296

6) Tests\Foundation\TenantTest::testTenantModelForSchools
Failed asserting that an array contains 1.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:318

7) Tests\Foundation\TenantTest::testUserCanBelongToMultipleSchools
Failed asserting that an array contains 1.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:404

8) Tests\Foundation\TenantTest::testPrimarySchoolIdentification
Failed asserting that null is not null.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:422

9) Tests\Foundation\TenantTest::testGetActiveSchools
Failed asserting that actual size 10 matches expected size 5.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:435

10) Tests\Foundation\TenantTest::testGetSchoolStatistics
Failed asserting that 0 matches expected 2.

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:458

11) Tests\Hr\HrServiceTest::testGetTeacherClasses
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Hr/HrServiceTest.php:179

12) Tests\Hr\HrServiceTest::testAssignTeacherToClass
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Hr/HrServiceTest.php:187

13) Tests\Inventory\InventoryServiceTest::testGetSchoolAssets
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:48

14) Tests\Inventory\InventoryServiceTest::testUpdateQuantityIn
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:71

15) Tests\Inventory\InventoryServiceTest::testUpdateQuantityOut
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:86

16) Tests\Inventory\InventoryServiceTest::testCannotReduceBelowZero
Failed asserting that 'Asset not found' [ASCII](length: 15) contains "Insufficient quantity" [ASCII](length: 21).

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:98

17) Tests\Inventory\InventoryServiceTest::testGetAssetTransactions
Failed asserting that 0 is equal to 3 or is greater than 3.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:113

18) Tests\Inventory\InventoryServiceTest::testGetLowStockItems
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:124

19) Tests\Inventory\InventoryServiceTest::testGetInventoryStats
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:142

20) Tests\Inventory\InventoryServiceTest::testSearchAssets
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:153

21) Tests\Inventory\InventoryServiceTest::testTransferAsset
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Inventory/InventoryServiceTest.php:163

22) Tests\Learning\LearningServiceTest::testGetSchoolCourses
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:34

23) Tests\Learning\LearningServiceTest::testGetCourseAssignments
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:63

24) Tests\Learning\LearningServiceTest::testSubmitGrade
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:102

25) Tests\Learning\LearningServiceTest::testCannotExceedMaxPoints
Failed asserting that 'Assignment not found' [ASCII](length: 20) contains "exceed maximum" [ASCII](length: 14).

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:128

26) Tests\Learning\LearningServiceTest::testUpdateExistingGrade
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:146

27) Tests\Learning\LearningServiceTest::testGetStudentGrades
Failed asserting that actual size 0 matches expected size 2.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:174

28) Tests\Learning\LearningServiceTest::testGetCourseAverage
Failed asserting that null is not null.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:192

29) Tests\Learning\LearningServiceTest::testGetAssignmentStats
Failed asserting that 0 matches expected 3.

/workspaces/shulelabsci4/tests/Learning/LearningServiceTest.php:213

30) Tests\Library\LibraryServiceTest::testGetSchoolBooks
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:49

31) Tests\Library\LibraryServiceTest::testBorrowBook
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:74

32) Tests\Library\LibraryServiceTest::testCannotBorrowWhenNoCopiesAvailable
Failed asserting that 'Book not found' [ASCII](length: 14) contains "No copies available" [ASCII](length: 19).

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:95

33) Tests\Library\LibraryServiceTest::testGetStudentBorrowings
Failed asserting that actual size 0 matches expected size 2.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:146

34) Tests\Library\LibraryServiceTest::testGetOverdueBooks
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:158

35) Tests\Library\LibraryServiceTest::testGetLibraryStats
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:174

36) Tests\Library\LibraryServiceTest::testSearchBooks
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Library/LibraryServiceTest.php:186

37) Tests\Threads\ThreadsServiceTest::testGetInbox
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:47

38) Tests\Threads\ThreadsServiceTest::testGetSentMessages
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:69

39) Tests\Threads\ThreadsServiceTest::testMarkAsRead
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:79

40) Tests\Threads\ThreadsServiceTest::testDeleteMessage
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:94

41) Tests\Threads\ThreadsServiceTest::testCannotDeleteOthersMessage
Failed asserting that 'Message not found' [ASCII](length: 17) contains "Unauthorized" [ASCII](length: 12).

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:109

42) Tests\Threads\ThreadsServiceTest::testGetAnnouncements
Failed asserting that 0 is greater than 0.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:133

43) Tests\Threads\ThreadsServiceTest::testDeactivateAnnouncement
Failed asserting that false is true.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:143

44) Tests\Threads\ThreadsServiceTest::testGetMessageThread
Failed asserting that 0 is equal to 3 or is greater than 3.

/workspaces/shulelabsci4/tests/Threads/ThreadsServiceTest.php:171

--

There were 2 risky tests:

1) Tests\Foundation\TenantTest::testTenantModelAutoScoping
This test did not perform any assertions

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:268

2) Tests\Foundation\TenantTest::testSchool1CannotSeeSchool2Data
This test did not perform any assertions

/workspaces/shulelabsci4/tests/Foundation/TenantTest.php:327

ERRORS!
Tests: 206, Assertions: 664, Errors: 9, Failures: 44, PHPUnit Warnings: 1, PHPUnit Deprecations: 1, Risky: 2.
